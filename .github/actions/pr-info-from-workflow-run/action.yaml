name: Extract PR information from a workflow run event
description: >
  When a workflow_run workflow is triggered by a workflow that was, in turn,
  triggered by a pull request, sometimes you need the detailed information
  about the pull request. This action extracts the PR information from the
  workflow run event and sets it as output variables.

outputs:
  pr-number:
    description: The number of the pull request.
    value: ${{ steps.extract.outputs.pr-number }}
  pr-headsha:
    description: The head SHA of the pull request.
    value: ${{ steps.extract.outputs.pr-headsha }}
  pr-title:
    description: The title of the pull request.
    value: ${{ steps.extract.outputs.pr-title }}
  pr-body:
    description: The body of the pull request.
    value: ${{ steps.extract.outputs.pr-body }}
  pr-author:
    description: The author of the pull request.
    value: ${{ steps.extract.outputs.pr-author }}

runs:
  using: 'composite'
  steps:
    - name: Extract PR metadata
      shell: bash
      id: extract
      run: |
        echo "pr-number=$(jq -r '.workflow_run.head_repository.pull_requests[0].number' $GITHUB_EVENT_PATH)" | tee -a $GITHUB_OUTPUT
        echo "pr-headsha=$(jq -r '.workflow_run.head_repository.pull_requests[0].head.sha' $GITHUB_EVENT_PATH)" | tee -a $GITHUB_OUTPUT
        echo "pr-title=$(jq -r '.workflow_run.head_repository.pull_requests[0].title' $GITHUB_EVENT_PATH)" | tee -a $GITHUB_OUTPUT
        echo "pr-body=$(jq -r '.workflow_run.head_repository.pull_requests[0].body' $GITHUB_EVENT_PATH)" | tee -a $GITHUB_OUTPUT
        echo "pr-author=$(jq -r '.workflow_run.head_repository.pull_requests[0].user.login' $GITHUB_EVENT_PATH)" | tee -a $GITHUB_OUTPUT
